<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Torneo de Parejas</title>
  <link rel="stylesheet" href="estilos.css" />
</head>
<body>
  <!-- Barra de navegación -->
  <nav>
    <ul>
      <li><a href="index.html">Inicio</a></li>
      <li><a href="liga.html">Liga</a></li>
      <li><a href="torneoparejas.html" class="activo">Torneo Parejas</a></li>
      <li><a href="historial.html">Historial</a></li>
    </ul>
  </nav>

  <main>
    <h1>Torneo de Parejas</h1>

    <!-- Formulario de ingreso de resultados -->
    <section id="ingreso-resultados">
      <h2>Ingresar Resultado</h2>
      <input type="text" id="pareja1" placeholder="Pareja 1 (Ej: Ana y Luis)" />
      <input type="number" id="goles1" placeholder="Goles Pareja 1" />
      <input type="text" id="pareja2" placeholder="Pareja 2 (Ej: Sol y Max)" />
      <input type="number" id="goles2" placeholder="Goles Pareja 2" />
      <button onclick="agregarResultado()">Agregar</button>
    </section>

    <!-- Lista de partidos -->
    <section>
      <h2>Partidos Jugados</h2>
      <ul id="lista-partidos"></ul>
    </section>

    <!-- Tablas -->
    <section id="tabla">
      <h2>Tabla de Posiciones (Por Parejas)</h2>
      <table id="tabla-parejas" border="1">
        <thead>
          <tr>
            <th>#</th>
            <th>Pareja</th>
            <th>PJ</th>
            <th>PG</th>
            <th>PE</th>
            <th>PP</th>
            <th>%PG</th>
            <th>%PE</th>
            <th>%PP</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <h2>Tabla Individual</h2>
      <table id="tabla-individual" border="1">
        <thead>
          <tr>
            <th>#</th>
            <th>Jugador/a</th>
            <th>PJ</th>
            <th>PG</th>
            <th>PE</th>
            <th>PP</th>
            <th>%PG</th>
            <th>%PE</th>
            <th>%PP</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Botón para guardar historial -->
    <section>
      <button onclick="guardarHistorialParejas()">Guardar historial</button>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <p>Desarrollado por SDD</p>
  </footer>

  <script>
    const partidos = [];

    function agregarResultado() {
      const p1 = document.getElementById('pareja1').value.trim();
      const g1 = parseInt(document.getElementById('goles1').value);
      const p2 = document.getElementById('pareja2').value.trim();
      const g2 = parseInt(document.getElementById('goles2').value);

      if (!p1 || isNaN(g1) || !p2 || isNaN(g2)) {
        alert("Por favor completá todos los campos correctamente.");
        return;
      }

      partidos.push({ pareja1: p1, goles1: g1, pareja2: p2, goles2: g2 });
      mostrarPartidos();
      actualizarTablas();
      limpiarInputs();
    }

    function mostrarPartidos() {
      const lista = document.getElementById('lista-partidos');
      lista.innerHTML = '';
      partidos.forEach((partido, index) => {
        const item = document.createElement('li');
        item.textContent = `${partido.pareja1} (${partido.goles1}) vs ${partido.pareja2} (${partido.goles2})`;
        lista.appendChild(item);
      });
    }

    function actualizarTablas() {
      const statsParejas = {};
      const statsJugadores = {};

      partidos.forEach(p => {
        const resultado1 = p.goles1 > p.goles2 ? 'G' : p.goles1 < p.goles2 ? 'P' : 'E';
        const resultado2 = p.goles2 > p.goles1 ? 'G' : p.goles2 < p.goles1 ? 'P' : 'E';

        [ [p.pareja1, resultado1], [p.pareja2, resultado2] ].forEach(([pareja, res]) => {
          if (!statsParejas[pareja]) statsParejas[pareja] = { pj: 0, pg: 0, pe: 0, pp: 0 };
          statsParejas[pareja].pj++;
          if (res === 'G') statsParejas[pareja].pg++;
          else if (res === 'E') statsParejas[pareja].pe++;
          else statsParejas[pareja].pp++;

          const jugadores = pareja.split(' y ');
          jugadores.forEach(j => {
            if (!statsJugadores[j]) statsJugadores[j] = { pj: 0, pg: 0, pe: 0, pp: 0 };
            statsJugadores[j].pj++;
            if (res === 'G') statsJugadores[j].pg++;
            else if (res === 'E') statsJugadores[j].pe++;
            else statsJugadores[j].pp++;
          });
        });
      });

      renderTabla('tabla-parejas', statsParejas);
      renderTabla('tabla-individual', statsJugadores);
    }

    function renderTabla(id, data) {
      const tbody = document.querySelector(`#${id} tbody`);
      tbody.innerHTML = '';

      const lista = Object.entries(data).map(([nombre, s]) => {
        const pj = s.pj || 1;
        return {
          nombre,
          pj: s.pj,
          pg: s.pg,
          pe: s.pe,
          pp: s.pp,
          pctPg: ((s.pg / pj) * 100).toFixed(1),
          pctPe: ((s.pe / pj) * 100).toFixed(1),
          pctPp: ((s.pp / pj) * 100).toFixed(1),
        };
      });

      lista.sort((a, b) => b.pg - a.pg);

      lista.forEach((d, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>${d.nombre}</td>
          <td>${d.pj}</td>
          <td>${d.pg}</td>
          <td>${d.pe}</td>
          <td>${d.pp}</td>
          <td>${d.pctPg}%</td>
          <td>${d.pctPe}%</td>
          <td>${d.pctPp}%</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function limpiarInputs() {
      document.getElementById('pareja1').value = '';
      document.getElementById('goles1').value = '';
      document.getElementById('pareja2').value = '';
      document.getElementById('goles2').value = '';
    }

    function guardarHistorialParejas() {
      const tabla = document.getElementById('tabla-parejas');
      const filas = tabla.querySelectorAll('tbody tr');
      let historial = JSON.parse(localStorage.getItem('historialParejas')) || {};

      filas.forEach(fila => {
        const columnas = fila.querySelectorAll('td');
        if (columnas.length === 9) {
          const nombre = columnas[1].textContent;
          const pj = parseInt(columnas[2].textContent);
          const pg = parseInt(columnas[3].textContent);
          const pe = parseInt(columnas[4].textContent);
          const pp = parseInt(columnas[5].textContent);

          if (!historial[nombre]) {
            historial[nombre] = { pj: 0, pg: 0, pe: 0, pp: 0 };
          }

          historial[nombre].pj += pj;
          historial[nombre].pg += pg;
          historial[nombre].pe += pe;
          historial[nombre].pp += pp;
        }
      });

      localStorage.setItem('historialParejas', JSON.stringify(historial));
      alert('Historial de parejas guardado correctamente.');
    }
  </script>
</body>
</html>