<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Torneo de los Pibes - Parejas Rotativas</title>
<style>
  :root {
    --bg: #fff;
    --text: #000;
    --accent: #3366cc;
    --menu-bg: #f0f0f0;
  }
  [data-theme="dark"] {
    --bg: #121212;
    --text: #fff;
    --accent: #3399ff;
    --menu-bg: #1e1e1e;
  }
  body {
    margin: 0;
    font-family: sans-serif;
    background-color: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  header {
    background: var(--menu-bg);
    border-bottom: 1px solid #ccc;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .title {
    font-weight: bold;
    font-size: 1.2rem;
  }
  .theme-toggle {
    cursor: pointer;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 2px solid var(--text);
    background: linear-gradient(90deg, #fff 50%, #000 50%);
  }
  main {
    flex: 1;
    max-width: 700px;
    margin: auto;
    padding: 30px 20px 80px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  section {
    width: 100%;
    display: none;
    flex-direction: column;
    align-items: center;
  }
  section.active {
    display: flex;
  }
  input[type="text"] {
    width: 220px;
    padding: 8px;
    margin: 8px 0;
    font-size: 1rem;
    text-align: center;
  }
  button {
    margin: 10px 5px;
    padding: 10px 22px;
    font-size: 1rem;
    background-color: var(--accent);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  button:disabled {
    background: #999;
    cursor: default;
  }
  .partido {
    display: flex;
    gap: 8px;
    align-items: center;
    margin: 8px 0;
    flex-wrap: wrap;
    justify-content: center;
  }
  .partido input[type="number"] {
    width: 40px;
    padding: 5px;
    text-align: center;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
  }
  footer {
    background: var(--menu-bg);
    border-top: 1px solid #ccc;
    text-align: center;
    padding: 10px 0;
  }
</style>
</head>
<body>
<header>
  <div class="title">Torneo de los Pibes</div>
  <div class="theme-toggle" title="Cambiar tema" onclick="toggleTheme()"></div>
</header>

<main>
  <!-- Ingreso de jugadores -->
  <section id="jugadores" class="active">
    <h2>Ingresá los 6 jugadores</h2>
    <div id="form-jugadores"></div>
    <button id="btnGenerar">Generar rondas</button>
  </section>

  <!-- Rondas generadas -->
  <section id="rondas">
    <h2>Rondas Generadas</h2>
    <div id="lista-rondas"></div>
    <button id="btnVerPartidos">Ver partidos</button>
    <button id="btnVolverJugadores">Volver</button>
  </section>

  <!-- Partidos -->
  <section id="partidos">
    <h2>Partidos</h2>
    <div id="partidos-lista"></div>
    <button id="btnVerTabla">Ver tabla</button>
    <button id="btnVolverRondas">Volver</button>
  </section>

  <!-- Tabla de posiciones -->
  <section id="tabla">
    <h2>Tabla de posiciones</h2>
    <div id="tabla-resultados"></div>
    <button id="btnVolverPartidos">Volver a partidos</button>
  </section>
</main>

<footer>Desarrollado por I.A</footer>

<script>
  // Tema guardado y toggle
  function toggleTheme() {
    const current = document.body.getAttribute('data-theme') || 'light';
    const next = current === 'dark' ? 'light' : 'dark';
    document.body.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
  }
  window.onload = () => {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.body.setAttribute('data-theme', savedTheme);
    crearInputsJugadores();
  };

  // Variables globales
  const secciones = ['jugadores', 'rondas', 'partidos', 'tabla'];
  let nombres = [];
  let rondas = [];
  let partidos = [];
  let resultados = [];

  // Mostrar sección activa
  function mostrarSeccion(id) {
    secciones.forEach(sec => {
      document.getElementById(sec).classList.remove('active');
    });
    document.getElementById(id).classList.add('active');
    window.scrollTo(0, 0);
  }

  // Crear inputs para 6 jugadores
  function crearInputsJugadores() {
    const cont = document.getElementById('form-jugadores');
    cont.innerHTML = '';
    for (let i = 1; i <= 6; i++) {
      const input = document.createElement('input');
      input.type = 'text';
      input.id = `jugador${i}`;
      input.placeholder = `Jugador ${i}`;
      cont.appendChild(input);
    }
  }

  // Validar y cargar nombres
  function cargarNombres() {
    nombres = [];
    for (let i = 1; i <= 6; i++) {
      const val = document.getElementById(`jugador${i}`).value.trim();
      if (!val) {
        alert('Completá todos los nombres.');
        return false;
      }
      if (nombres.includes(val)) {
        alert('No pueden repetirse nombres.');
        return false;
      }
      nombres.push(val);
    }
    return true;
  }

  // Generar rondas (pares de parejas sin repetir jugadores)
  // Algoritmo: generar todas las parejas posibles y luego armar 5 rondas con 3 partidos cada una (sin repetir jugadores en una ronda)
  function generarRondas() {
    if (!cargarNombres()) return;

    // Generar todas las parejas posibles
    const parejas = [];
    for (let i = 0; i < 6; i++) {
      for (let j = i + 1; j < 6; j++) {
        parejas.push([nombres[i], nombres[j]]);
      }
    }

    // Ahora debemos armar las rondas (5 rondas con 3 partidos sin repetir jugadores en una misma ronda)
    rondas = [];
    const usadosPorRonda = [];

    function puedeAgregar(ronda, pareja) {
      return !ronda.some(p => p.includes(pareja[0]) || p.includes(pareja[1]));
    }

    // Buscamos combinar parejas para armar rondas sin superposición de jugadores
    // Esta función busca recursivamente hasta armar 5 rondas
    function armarRondas(rondasActuales, parejasRestantes) {
      if (rondasActuales.length === 5) {
        rondas = rondasActuales;
        return true;
      }
      // Intentar armar una ronda
      for (let i = 0; i < parejasRestantes.length; i++) {
        for (let j = i + 1; j < parejasRestantes.length; j++) {
          for (let k = j + 1; k < parejasRestantes.length; k++) {
            const rondaPosible = [parejasRestantes[i], parejasRestantes[j], parejasRestantes[k]];
            // Verificar que no se repitan jugadores en la ronda
            const jugadoresEnRonda = rondaPosible.flat();
            const setJugadores = new Set(jugadoresEnRonda);
            if (setJugadores.size === 6) {
              // Validar que no haya jugadores repetidos con rondas anteriores
              // pero acá no lo necesitamos, porque solo chequeamos ronda individual
              // Verificar que estas parejas no estén en rondas anteriores para evitar repetir partidos
              const usadasAntes = rondasActuales.flat().map(p => p.join('-'));
              const nuevas = rondaPosible.map(p => p.join('-'));
              if (nuevas.some(np => usadasAntes.includes(np))) continue;
              // Construir parejas restantes para la siguiente llamada
              const nuevasParejasRestantes = parejasRestantes.filter((_, idx) => idx !== i && idx !== j && idx !== k);
              if (armarRondas([...rondasActuales, rondaPosible], nuevasParejasRestantes)) return true;
            }
          }
        }
      }
      return false;
    }

    if (!armarRondas([], parejas)) {
      alert('No se pudo generar un calendario válido.');
      return;
    }

    // Extraer partidos para poner en la lista (2 parejas enfrentadas por partido)
    partidos = [];
    for (const ronda of rondas) {
      // Cada ronda tiene 3 parejas, formamos 3 partidos:
      // partido1: parejas[0] vs parejas[1]
      // partido2: parejas[2] vs parejas[0] (esto puede variar)
      // Pero mejor: armamos partidos en pares de 2 parejas por ronda, para total 3 partidos
      // Para simplicidad: cada ronda son 3 partidos formados por las 3 parejas, 2 vs 1 y 3 vs ??
      // Mejor simplemente en esta app: cada partido es dos parejas (las parejas de la ronda en orden)
      // Por simplicidad mostramos partido1: pareja0 vs pareja1, partido2: pareja2 vs pareja0, partido3: pareja1 vs pareja2
      // Pero para no complicar, muestro las 3 parejas enfrentándose 2 a 2, en partidos consecutivos:
      // por ronda, partidos: (0 vs 1), (2 vs -) no hay tercera pareja para partido 3, así que solo 2 partidos
      // Mejor mostrar partidos: (0 vs 1), (1 vs 2), (0 vs 2)
      partidos.push([ronda[0], ronda[1]]);
      partidos.push([ronda[1], ronda[2]]);
      partidos.push([ronda[0], ronda[2]]);
    }

    // Inicializar resultados vacíos (null)
    resultados = partidos.map(() => [null, null]);

    mostrarSeccion('rondas');
    mostrarRondas();
  }

  function mostrarRondas() {
    const cont = document.getElementById('lista-rondas');
    cont.innerHTML = '';
    rondas.forEach((ronda, i) => {
      cont.innerHTML += `<h4>Ronda ${i + 1}</h4>` +
        ronda.map(pareja => `<p>${pareja[0]} + ${pareja[1]}</p>`).join('');
    });
  }

  function mostrarPartidos() {
    const cont = document.getElementById('partidos-lista');
    cont.innerHTML = '';
    partidos.forEach((partido, i) => {
      const [eq1, eq2] = partido;
      const res = resultados[i] || [null, null];
      cont.innerHTML += `
        <div class="partido">
          <span>${eq1[0]} + ${eq1[1]}</span>
          <input type="number" min="0" value="${res[0] ?? ''}" onchange="guardarResultado(${i}, 0, this.value)">
          <span>vs</span>
          <input type="number" min="0" value="${res[1] ?? ''}" onchange="guardarResultado(${i}, 1, this.value)">
          <span>${eq2[0]} + ${eq2[1]}</span>
        </div>
      `;
    });
  }

  function guardarResultado(idx, equipo, val) {
    if (!resultados[idx]) resultados[idx] = [null, null];
    resultados[idx][equipo] = val === '' ? null : Number(val);
  }

  function mostrarTabla() {
    // Calcular tabla por pareja e individual
    const tablaParejas = {};
    const tablaIndividual = {};

    resultados.forEach((res, idx) => {
      if (res[0] == null || res[1] == null) return; // ignorar si falta resultado
      const [eq1, eq2] = partidos[idx];
      const nombreEq1 = `${eq1[0]} + ${eq1[1]}`;
      const nombreEq2 = `${eq2[0]} + ${eq2[1]}`;

      // Inicializar si no existe
      if (!tablaParejas[nombreEq1]) tablaParejas[nombreEq1] = { pts:0, pj:0, dg:0 };
      if (!tablaParejas[nombreEq2]) tablaParejas[nombreEq2] = { pts:0, pj:0, dg:0 };

      tablaParejas[nombreEq1].pj++;
      tablaParejas[nombreEq2].pj++;

      tablaParejas[nombreEq1].dg += res[0] - res[1];
      tablaParejas[nombreEq2].dg += res[1] - res[0];

      if (res[0] > res[1]) {
        tablaParejas[nombreEq1].pts += 3;
      } else if (res[1] > res[0]) {
        tablaParejas[nombreEq2].pts += 3;
      } else {
        tablaParejas[nombreEq1].pts += 1;
        tablaParejas[nombreEq2].pts += 1;
      }

      // Individual
      [eq1[0], eq1[1], eq2[0], eq2[1]].forEach(j => {
        if (!tablaIndividual[j]) tablaIndividual[j] = { pts:0, pj:0, dg:0 };
      });

      [eq1[0], eq1[1]].forEach(j => {
        tablaIndividual[j].pj++;
        tablaIndividual[j].dg += res[0] - res[1];
        if (res[0] > res[1]) tablaIndividual[j].pts += 3;
        else if (res[0] === res[1]) tablaIndividual[j].pts += 1;
      });

      [eq2[0], eq2[1]].forEach(j => {
        tablaIndividual[j].pj++;
        tablaIndividual[j].dg += res[1] - res[0];
        if (res[1] > res[0]) tablaIndividual[j].pts += 3;
        else if (res[0] === res[1]) tablaIndividual[j].pts += 1;
      });
    });

    const div = document.getElementById('tabla-resultados');
    div.innerHTML = `
      <h3>Tabla por Parejas</h3>
      <table>
        <thead><tr><th>Pareja</th><th>Pts</th><th>PJ</th><th>DG</th></tr></thead>
        <tbody>
          ${Object.entries(tablaParejas)
            .sort((a,b) => b[1].pts - a[1].pts)
            .map(([nombre, val]) => `
              <tr>
                <td>${nombre}</td>
                <td>${val.pts}</td>
                <td>${val.pj}</td>
                <td>${val.dg}</td>
              </tr>`).join('')}
        </tbody>
      </table>
      <h3>Tabla Individual</h3>
      <table>
        <thead><tr><th>Jugador</th><th>Pts</th><th>PJ</th><th>DG</th></tr></thead>
        <tbody>
          ${Object.entries(tablaIndividual)
            .sort((a,b) => b[1].pts - a[1].pts)
            .map(([nombre, val]) => `
              <tr>
                <td>${nombre}</td>
                <td>${val.pts}</td>
                <td>${val.pj}</td>
                <td>${val.dg}</td>
              </tr>`).join('')}
        </tbody>
      </table>
    `;
  }

  // Botones y eventos
  document.getElementById('btnGenerar').addEventListener('click', () => {
    generarRondas();
  });

  document.getElementById('btnVerPartidos').addEventListener('click', () => {
    mostrarSeccion('partidos');
    mostrarPartidos();
  });

  document.getElementById('btnVolverJugadores').addEventListener('click', () => {
    mostrarSeccion('jugadores');
  });

  document.getElementById('btnVerTabla').addEventListener('click', () => {
    mostrarSeccion('tabla');
    mostrarTabla();
  });

  document.getElementById('btnVolverRondas').addEventListener('click', () => {
    mostrarSeccion('rondas');
  });

  document.getElementById('btnVolverPartidos').addEventListener('click', () => {
    mostrarSeccion('partidos');
  });
</script>
</body>
</html>