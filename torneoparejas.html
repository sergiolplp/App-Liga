<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Torneo por Parejas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="icono_torneo.ico" type="image/x-icon">
  <link rel="stylesheet" href="estilos.css">
</head>
<body>
  <header>
    <h1>Torneo por Parejas</h1>
    <nav>
      <a href="index.html">Inicio</a>
      <a href="liga.html">Liga</a>
      <a href="torneoparejas.html">Parejas</a>
      <a href="historial.html">Historial</a>
    </nav>
  </header>

  <main>
    <section>
      <label for="jugadores">Nombres (m√≠nimo 4, separados por coma):</label>
      <input type="text" id="jugadores" placeholder="Ej: Ana,Juan,Luis,Camila">
      <button onclick="iniciarTorneo()">Iniciar Torneo</button>
    </section>

    <section id="rondas"></section>
    <section id="partidos"></section>

    <section id="tabla">
      <h2>Tabla por Parejas</h2>
      <table id="tabla-parejas">
        <thead>
          <tr>
            <th>Pareja</th>
            <th>PJ</th>
            <th>PG</th>
            <th>PP</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <h2>Tabla Individual</h2>
      <table id="tabla-individual">
        <thead>
          <tr>
            <th>Jugador</th>
            <th>PJ</th>
            <th>PG</th>
            <th>PP</th>
            <th>Pts</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <button onclick="guardarEnHistorial()">Guardar Historial</button>
  </main>

  <footer>
    <p>Desarrollado por SDD</p>
  </footer>

  <script>
    let parejas = [];
    let resultadosParejas = {};
    let resultadosIndividuales = {};

    function iniciarTorneo() {
      const input = document.getElementById("jugadores").value.trim();
      const nombres = input.split(",").map(n => n.trim()).filter(n => n);
      if (nombres.length < 4 || nombres.length % 2 !== 0) {
        alert("Debe ingresar al menos 4 nombres y en cantidad par.");
        return;
      }

      // Formar parejas
      parejas = [];
      for (let i = 0; i < nombres.length; i += 2) {
        parejas.push([nombres[i], nombres[i + 1]]);
      }

      resultadosParejas = {};
      resultadosIndividuales = {};
      mostrarRondas();
      mostrarTablas();
    }

    function mostrarRondas() {
      const cont = document.getElementById("rondas");
      cont.innerHTML = "<h2>Rondas</h2>";

      let ronda = 1;
      let cantidadPartidos = Math.floor(parejas.length / 2);
      let usados = [...parejas];

      for (let i = 0; i < cantidadPartidos; i++) {
        if (usados.length < 2) break;

        const [a1, a2] = usados.shift();
        const [b1, b2] = usados.shift();

        cont.innerHTML += `
          <div class="partido">
            <h3>Ronda ${ronda++}</h3>
            <p>${a1} y ${a2} vs ${b1} y ${b2}</p>
            <button onclick="registrarResultado('${a1}', '${a2}', '${b1}', '${b2}', true)">Ganaron ${a1} y ${a2}</button>
            <button onclick="registrarResultado('${a1}', '${a2}', '${b1}', '${b2}', false)">Ganaron ${b1} y ${b2}</button>
          </div>`;
      }
    }

    function registrarResultado(a1, a2, b1, b2, ganaA) {
      const parejaA = `${a1} y ${a2}`;
      const parejaB = `${b1} y ${b2}`;

      if (!resultadosParejas[parejaA]) resultadosParejas[parejaA] = { pj: 0, pg: 0, pp: 0, pts: 0 };
      if (!resultadosParejas[parejaB]) resultadosParejas[parejaB] = { pj: 0, pg: 0, pp: 0, pts: 0 };

      resultadosParejas[parejaA].pj++;
      resultadosParejas[parejaB].pj++;

      if (ganaA) {
        resultadosParejas[parejaA].pg++;
        resultadosParejas[parejaA].pts += 3;
        resultadosParejas[parejaB].pp++;
      } else {
        resultadosParejas[parejaB].pg++;
        resultadosParejas[parejaB].pts += 3;
        resultadosParejas[parejaA].pp++;
      }

      [a1, a2, b1, b2].forEach(j => {
        if (!resultadosIndividuales[j]) resultadosIndividuales[j] = { pj: 0, pg: 0, pp: 0, pts: 0 };
        resultadosIndividuales[j].pj++;
      });

      if (ganaA) {
        [a1, a2].forEach(j => { resultadosIndividuales[j].pg++; resultadosIndividuales[j].pts += 3; });
        [b1, b2].forEach(j => resultadosIndividuales[j].pp++);
      } else {
        [b1, b2].forEach(j => { resultadosIndividuales[j].pg++; resultadosIndividuales[j].pts += 3; });
        [a1, a2].forEach(j => resultadosIndividuales[j].pp++);
      }

      mostrarTablas();
    }

    function mostrarTablas() {
      const cuerpoParejas = document.querySelector("#tabla-parejas tbody");
      cuerpoParejas.innerHTML = "";
      for (const pareja in resultadosParejas) {
        const r = resultadosParejas[pareja];
        cuerpoParejas.innerHTML += `
          <tr>
            <td>${pareja}</td>
            <td>${r.pj}</td>
            <td>${r.pg}</td>
            <td>${r.pp}</td>
            <td>${r.pts}</td>
          </tr>`;
      }

      const cuerpoInd = document.querySelector("#tabla-individual tbody");
      cuerpoInd.innerHTML = "";
      for (const j in resultadosIndividuales) {
        const r = resultadosIndividuales[j];
        cuerpoInd.innerHTML += `
          <tr>
            <td>${j}</td>
            <td>${r.pj}</td>
            <td>${r.pg}</td>
            <td>${r.pp}</td>
            <td>${r.pts}</td>
          </tr>`;
      }
    }

    function guardarEnHistorial() {
      const tabla = document.querySelector("#tabla-parejas tbody");
      const filas = tabla.querySelectorAll("tr");

      let historial = JSON.parse(localStorage.getItem("historialTorneoParejas")) || {};

      filas.forEach(fila => {
        const celdas = fila.querySelectorAll("td");
        const nombre = celdas[0].textContent;
        const pj = parseInt(celdas[1].textContent);
        const pg = parseInt(celdas[2].textContent);
        const pp = parseInt(celdas[3].textContent);
        const pts = parseInt(celdas[4].textContent);

        if (!historial[nombre]) {
          historial[nombre] = { pj, pg, pp, pts };
        } else {
          historial[nombre].pj += pj;
          historial[nombre].pg += pg;
          historial[nombre].pp += pp;
          historial[nombre].pts += pts;
        }
      });

      localStorage.setItem("historialTorneoParejas", JSON.stringify(historial));
      alert("Historial guardado correctamente.");
    }
  </script>
</body>
</html>