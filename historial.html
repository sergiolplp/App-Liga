<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Historial Liga</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f1f1f1;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #007acc;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: white;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #007acc;
      color: white;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>

  <h1>Historial - Liga</h1>
  <div id="historial-container"></div>

  <script>
    function cargarHistorialLiga() {
      const container = document.getElementById('historial-container');
      const historialData = JSON.parse(localStorage.getItem('historialLiga'));

      if (!historialData || historialData.length === 0) {
        container.innerHTML = "<p>No hay datos de historial guardados.</p>";
        return;
      }

      // Agrupar estadÃ­sticas por jugador
      const statsPorJugador = {};

      historialData.forEach((partido) => {
        partido.forEach((jugador) => {
          const { nombre, PG, PE, PP } = jugador;
          if (!statsPorJugador[nombre]) {
            statsPorJugador[nombre] = { PJ: 0, PG: 0, PE: 0, PP: 0 };
          }
          statsPorJugador[nombre].PG += PG;
          statsPorJugador[nombre].PE += PE;
          statsPorJugador[nombre].PP += PP;
          statsPorJugador[nombre].PJ += PG + PE + PP;
        });
      });

      // Convertir a array para ordenar
      const lista = Object.entries(statsPorJugador).map(([nombre, stats]) => {
        const { PJ, PG, PE, PP } = stats;
        const porcentaje = (valor) => PJ > 0 ? ((valor / PJ) * 100).toFixed(1) + "%" : "0%";
        return {
          nombre,
          PJ,
          PG,
          PE,
          PP,
          PPG: porcentaje(PG),
          PPE: porcentaje(PE),
          PPP: porcentaje(PP)
        };
      });

      // Ordenar por PG descendente
      lista.sort((a, b) => b.PG - a.PG);

      // Crear tabla
      let html = `
        <table>
          <tr>
            <th>#</th>
            <th>Nombre</th>
            <th>PJ</th>
            <th>PG</th>
            <th>PE</th>
            <th>PP</th>
            <th>%PG</th>
            <th>%PE</th>
            <th>%PP</th>
          </tr>
      `;

      lista.forEach((jug, index) => {
        html += `
          <tr>
            <td>${index + 1}</td>
            <td>${jug.nombre}</td>
            <td>${jug.PJ}</td>
            <td>${jug.PG}</td>
            <td>${jug.PE}</td>
            <td>${jug.PP}</td>
            <td>${jug.PPG}</td>
            <td>${jug.PPE}</td>
            <td>${jug.PPP}</td>
          </tr>
        `;
      });

      html += "</table>";
      container.innerHTML = html;
    }

    cargarHistorialLiga();
  </script>
</body>
</html>